<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" type="image/png" href="/assets/design/favicon.png" />

  <title>Build a privacy-safe home network using Pi-hole</title>
  <meta name="description" content="Data privacy, and the usage of collected data have now became a controversial subject. People tends to aknowlegde more and more the importance of keeping pri...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/dist/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="canonical" href="https://www.thomasdurand.fr/security/network/2018/10/20/privacy-at-home-with-pi-hole.html">
  <link rel="alternate" type="application/rss+xml" title="Dean's blog" href="https://www.thomasdurand.fr/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">
      <img src="/assets/design/logo@2x.png" height="40" alt="Dean's blog"/>
    </a>

    <nav class="site-nav">
      
      
        <a class="page-link" href="/">Stories</a>
      
        <a class="page-link" href="/about/">About</a>
      
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Build a privacy-safe home network using Pi-hole</h1>
    <p class="post-date"><time datetime="2018-10-20T17:00:00+02:00" itemprop="datePublished">Oct 20, 2018</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Dean</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Data privacy, and the usage of collected data have now became a controversial subject. People tends to aknowlegde more and more the importance of keeping private data ; and private life … well … private.</p>

<p>In this tutorial, you’ll see what solution I came around keeping my own privacy at my home network.</p>
      <h2 id="what-is-pi-hole">
        
        
          What is Pi-hole? <a href="#what-is-pi-hole" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p><a href="https://pi-hole.net/">Pi-hole</a>, as they describe themselves, is an open-source <a href="https://en.wikipedia.org/wiki/DNS_sinkhole">DNS sinkhole</a>.
It is a custom DNS ; that will drop request during the DNS resolution step if it’s been blacklisted.</p>

<p>The main advantage of dropping request at DNS resolution step is that the request never leave your own network: 
It is first sent to your Raspberry Pi, and then dropped immediately if it’s been blacklisted.</p>

<p>It means that blacklisted remote servers never have to know that you even exist!
The ad are dropped before even loading, and not at rendering time, granting your network better performances.</p>

<p>Of course, some ad-based blacklist are provided, making Pi-hole a powerful and <strong>untraceable</strong> ad-blocker.</p>
    
      <h2 id="setting-up-your-raspberry-pi">
        
        
          Setting up your Raspberry Pi <a href="#setting-up-your-raspberry-pi" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p>This step if <strong>optional</strong>, but it’s always good to start with a <em>fresh install</em>.
You can, of course, skip immediately to <a href="#installing-pi-hole">Pi-hole installation</a>.</p>
    
      <h3 id="raspbian-stretch-installation">
        
        
          Raspbian Stretch installation <a href="#raspbian-stretch-installation" class="post-link-anchor">&para;</a>
        
        
      </h3>

<p>Download the <a href="https://downloads.raspberrypi.org/raspbian_lite_latest">latest release of Raspbian Stretch</a> on your disk.
Then, we need to copy it on your SD card, properly.</p>

<p>On macOS, It can be done with the following commands.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>diskutil list <span class="c"># Note the number associated with your SD card. (ie disk2 for instance)</span>
<span class="nv">$ </span>diskutil unmountDisk /dev/disk2
<span class="nv">$ </span><span class="nb">sudo dd </span><span class="nv">bs</span><span class="o">=</span>1m <span class="k">if</span><span class="o">=</span>raspbian-stretch-lite.img <span class="nv">of</span><span class="o">=</span>/dev/rdisk2 <span class="nv">conv</span><span class="o">=</span><span class="nb">sync</span></code></pre></figure>

<p>We then need to enable SSH before plugging the SD card in the Raspberry for the first boot:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> /Volumes/boot/
<span class="nv">$ </span><span class="nb">touch </span>ssh</code></pre></figure>

<p>And we unmount the disk</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> ~
<span class="nv">$ </span>diskutil unmountDisk /dev/disk2</code></pre></figure>

<p>Now, you can plug your SD card in your Raspberry and wait it to boot.</p>

<p>You may now connect to it using SSH:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ssh pi@192.168.1.x</code></pre></figure>

<p>Default password is <code class="highlighter-rouge">raspberry</code></p>
    
      <h3 id="minimal-security-settings">
        
        
          Minimal security settings <a href="#minimal-security-settings" class="post-link-anchor">&para;</a>
        
        
      </h3>

<p>The bare minimum to do when the Raspberry first start is to <strong>change the password for the pi user</strong>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>passwd</code></pre></figure>

<p>You may also want to:</p>
<ul>
  <li>create your own user with sudo auth, and then delete the pi user</li>
  <li>change the SSH port</li>
  <li>Authenticate using a private key</li>
  <li>Requiring a password when using <code class="highlighter-rouge">sudo</code></li>
  <li>Update the repositories and packages</li>
</ul>
    
      <h2 id="installing-pi-hole">
        
        
          Installing Pi-hole <a href="#installing-pi-hole" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p>It is advised that your Raspberry Pi should have a static IP on your network.</p>

<p>From your Raspberry, you can run the installer by executing:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>wget <span class="nt">-O</span> basic-install.sh https://install.pi-hole.net
<span class="nv">$ </span><span class="nb">sudo </span>bash basic-install.sh</code></pre></figure>

<p>The installation should guide you through the process. When prompted to validate the IP as a static IP, say yes ; 
and always make sure that the IP is effectively static in order to work.</p>

<p>At the end of the installation process, the administration password will be prompted to you if you choose to install the web administration interface, along with lighttp.</p>

<p>It’s, of course, recommended to change it using <code class="highlighter-rouge">sudo pihole -a -p</code></p>

<p>You then need to set up the static IP of your Raspberry as your primary DNS server on your router.
If you can’t, it’s still possible to use the Raspberry as your main DHCP server. (Disable your old one if you choose this option).</p>

<p><img src="/assets/screenshots/setting-dns.png" alt="How to set primary DNS with DHCP" /></p>

<p>You may now use the internet with no ads or trackers!</p>
    
      <h2 id="customize-your-network-with-aliases">
        
        
          Customize your network with aliases <a href="#customize-your-network-with-aliases" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p>You can, if you want, create aliases to communicate more easily with your devices associated with a static IP.</p>

<p>For instance, using <code class="highlighter-rouge">box.lan</code> instead of <code class="highlighter-rouge">192.168.1.1</code> or <code class="highlighter-rouge">pi.lan</code> instead of <code class="highlighter-rouge">192.168.1.x</code>.</p>

<p>To do so, you need to create an alias file:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>nano /etc/pihole/lan.conf</code></pre></figure>

<p>Containing, for instance:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>192.168.1.1 box.lan
192.168.1.2 router.lan
192.168.1.3 pi.lan
</code></pre></div></div>

<p>Then, add this configuration file to dnsmasq, and reload it</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"addn-hosts=/etc/pihole/lan.list"</span> | <span class="nb">sudo tee</span> /etc/dnsmasq.d/02-lan.conf
<span class="nb">sudo </span>pihole restartdns</code></pre></figure>
    
      <h2 id="using-the-web-admin-to-check-your-traffic">
        
        
          Using the web admin to check your traffic <a href="#using-the-web-admin-to-check-your-traffic" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p>Once Pi-hole is enabled, you can access <a href="http://pi.hole/">http://pi.hole</a>.</p>

<p><img src="/assets/screenshots/pi-hole-home.png" alt="The home page of Pi Hole Admin" /></p>

<p>To have access to a lot of more informations, you may login with the password you have setted during installation.</p>

<p>If you forgot your password already, you can reset it easily using <code class="highlighter-rouge">sudo pihole -a -p</code> (I know, I repeat myself!)</p>

<p>You’ll see the top blocked domains, and the most recents requests.</p>

<p><img src="/assets/screenshots/pi-hole-blocked.png" alt="The home page of Pi Hole Admin" /></p>

<p>If you don’t want to track your network that much, you may want to change <a href="http://pi.hole/admin/settings.php?tab=privacy">privacy level mode in the settings</a>.</p>

<p>By regulary check the requests that have been blocked, and the one that are allowed, you’ll be able to whitelist some request you don’t mind see go threw, and blacklist the one that looks shady.</p>

<p><strong>Fun fact:</strong> When I connected the Android phone of my girlfriend, this is what happened:</p>

<p><img src="/assets/screenshots/pi-hole-android.png" alt="The home page of Pi Hole Admin" /></p>
    
      <h2 id="bonus-redirecting-a-dns-resolution">
        
        
          Bonus: redirecting a DNS resolution <a href="#bonus-redirecting-a-dns-resolution" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p>As described in my article <a href="/security/iot/2018/01/31/how-anyone-could-feed-my-cat.html">How everyone could feed my cat</a>, 
I needed to redirect the resolution of my feeder to prevent it to communicate with the original server.</p>

<p>I have built a <a href="https://github.com/Dean151/Aln-NodeJs">custom API</a>, that is hosted on my server. And to make it work, I have to redirect my feeder requests to my server.</p>

<p>It’s doable, simply by editing the <code class="highlighter-rouge">etc/hosts</code> file :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[...]
51.38.185.236 dev.alnpet.com
</code></pre></div></div>

<p>Then, by restarting the DNS with <code class="highlighter-rouge">sudo pihole restartdns</code> ; the feeder communicate with my server, and not with theirs.</p>
    
      <h2 id="going-way-further">
        
        
          Going way further <a href="#going-way-further" class="post-link-anchor">&para;</a>
        
        
      </h2>

<p>You now have a fully functional ad &amp; tracker blocker from the network side.</p>

<p>If you’re really concerned about privacy, you should look forward of installing your <a href="https://docs.pi-hole.net/guides/unbound/">own DNS resolver using unbound</a></p>

<p>Otherwise, for more security, you should <a href="https://docs.pi-hole.net/guides/dns-over-https/">configure DNS over HTTPS</a> with <code class="highlighter-rouge">cloudflared</code>, 
securing the DNS resolving using a TLS connexion, and preventing snooping, monitoring or other types of attacks.</p>

<p>Finally, if you want to make your pi-hole admin interface available from the outside world, you really should consider <a href="https://discourse.pi-hole.net/t/enabling-https-for-your-pi-hole-web-interface/5771">an HTTPS configuration</a>.</p>
  </div>

  <hr>

<div class="share-section">
    <h1><a href="https://github.com/Dean151/Dean-Blog/edit/master/_posts/2018-10-20-privacy-at-home-with-pi-hole.markdown" rel="nofollow" target="_blank" title="Edit on GitHub">Edit</a> or share this story:</h1>
    <ul>
        
        <li class="share-button share-twitter">
            <a href="https://twitter.com/intent/tweet?text=Build+a+privacy-safe+home+network+using+Pi-hole&amp;url=https%3A%2F%2Fwww.thomasdurand.fr%2Fsecurity%2Fnetwork%2F2018%2F10%2F20%2Fprivacy-at-home-with-pi-hole.html&amp;via=deanatoire&amp;related=deanatoire" rel="nofollow" target="_blank" title="Share on Twitter">
                <span class="fa fa-twitter"></span>
            </a>
        </li>
        <li class="share-button share-facebook">
            <a href="https://facebook.com/sharer.php?u=https%3A%2F%2Fwww.thomasdurand.fr%2Fsecurity%2Fnetwork%2F2018%2F10%2F20%2Fprivacy-at-home-with-pi-hole.html" rel="nofollow" target="_blank" title="Share on Facebook">
                <span class="fa fa-facebook-official"></span>
            </a>
        </li>
        <li class="share-button share-linkedin">
            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.thomasdurand.fr%2Fsecurity%2Fnetwork%2F2018%2F10%2F20%2Fprivacy-at-home-with-pi-hole.html&amp;title=Build+a+privacy-safe+home+network+using+Pi-hole&amp;summary=Dean%27s+blog+is+a+blog+about+computer+science+and+development&amp;source=https%3A%2F%2Fwww.thomasdurand.fr" rel="nofollow" target="_blank" title="Share on LinkedIn">
                <span class="fa fa-linkedin-square"></span>
            </a>
        </li>
        
    </ul>
</div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Dean's blog</li>
          <li><a href="mailto:contact@thomasdurand.fr">contact@thomasdurand.fr</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-3"></div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/dean151"><span class="fa fa-github"></span> <span class="username">dean151</span></a>
          </li>
          

          
          <li>
            <a href="https://linkedin.com/in/thomasdurandverjat"><span class="fa fa-linkedin"></span> <span class="username">thomasdurandverjat</span></a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/deanatoire"><span class="fa fa-twitter"></span> <span class="username">deanatoire</span></a>
          </li>
          

          <li>
            <a href="/feed.xml"><span class="fa fa-rss"></span> <span class="username">rss flux</span></a>
          </li>
        </ul>
      </div>
    </div>

  </div>

</footer>

<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    _paq.push(['setTrackerUrl', '/p/']);
    _paq.push(['setSiteId', '14']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='/p/'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="/p/?idsite=14&rec=1" style="border:0;" alt="" /></p></noscript>

  </body>

</html>
